@model WarehouseTracker.Models.Product
@using WarehouseTracker.Enums

@{
    var statusClass = Model.Status switch
    {
        ProductStatus.InStock => "badge-success",
        ProductStatus.InTransit => "badge-info",
        ProductStatus.Delivered => "badge-secondary",
        ProductStatus.Delayed => "badge-warning",
        ProductStatus.OutOfStock => "badge-danger",
        _ => "badge-secondary"
    };
}

<tr id="product-row-@Model.Id" class="product-row table-warning htmx-transition">
    <td class="col-check">
        <input type="checkbox" 
               name="SelectedIds"
               value="@Model.Id"
               onchange="updateBulkBar()"
               class="row-checkbox" disabled/>
    </td>
    <!-- Name -->
    <td>
        <input type="text"
               name="Name"
               value="@Model.Name"
               class="form-control form-control-sm @(ViewData.ModelState["Name"]?.Errors.Any() == true ? "is-invalid" : "")"
               placeholder="Product Name"
               maxlength="25"
               required />
        @if (ViewData.ModelState["Name"]?.Errors.Any() == true)
        {
            <div class="invalid-feedback">@ViewData.ModelState["Name"]!.Errors.First().ErrorMessage</div>
        }
    </td>

    <!-- Description -->
    <td>
        <input type="text"
               name="Description"
               value="@Model.Description"
               class="form-control form-control-sm @(ViewData.ModelState["Description"]?.Errors.Any() == true ? "is-invalid" : "")"
               placeholder="Description"
               maxlength="250" />
        @if (ViewData.ModelState["Description"]?.Errors.Any() == true)
        {
            <div class="invalid-feedback">@ViewData.ModelState["Description"]!.Errors.First().ErrorMessage</div>
        }
    </td>

    <!-- Price -->
    <td>
        <input type="number"
               name="Price"
               value="@Model.Price"
               class="form-control form-control-sm text-end @(ViewData.ModelState["Price"]?.Errors.Any() == true ? "is-invalid" : "")"
               min="0.01"
               step="0.01"
               required />
        @if (ViewData.ModelState["Price"]?.Errors.Any() == true)
        {
            <div class="invalid-feedback">@ViewData.ModelState["Price"]!.Errors.First().ErrorMessage</div>
        }
    </td>

    <!-- Stock Quantity -->
    <td>
        <input type="number"
               name="StockQuantity"
               value="@Model.StockQuantity"
               class="form-control form-control-sm text-end @(ViewData.ModelState["StockQuantity"]?.Errors.Any() == true ? "is-invalid" : "")"
               required />
        @if (ViewData.ModelState["StockQuantity"]?.Errors.Any() == true)
        {
            <div class="invalid-feedback">@ViewData.ModelState["StockQuantity"]!.Errors.First().ErrorMessage</div>
        }
    </td>

    <!-- Category -->
    <td>
        <!-- Visible display -->
        <span class="category-badge">@Model.Category?.Name</span>

        @if (Model.SubCategory != null)
        {
            <span class="subcategory-badge">@Model.SubCategory.Name</span>
        }

        <input type="hidden" name="CategoryId" value="@Model.CategoryId" />
        <input type="hidden" name="SubCategoryId" value="@Model.SubCategoryId" />
    </td>

    <td>
        <span class="badge @statusClass">@Model.Status</span>
    </td>

    <!-- Created/Updated -->
    <td>@Model.CreatedAt.ToString("yyyy-MM-dd")</td>
    <td>@Model.UpdatedAt.ToString("yyyy-MM-dd")</td>

    <!-- Actions -->
    <td class="text-center">
        <input type="hidden" name="Id" value="@Model.Id" />
        <input type="hidden" name="RowVersion" value="@Convert.ToBase64String(Model.RowVersion)" />
        <div class="btn-group btn-group-sm" role="group">
            <!-- Save -->
            <button type="button"
                    class="btn btn-success"
                    title="Save changes"
                    hx-put="/Product/Update"
                    hx-target="closest tr"
                    hx-swap="outerHTML swap:200ms"
                    hx-select="tr"
                    hx-include="closest tr, #inventory-value"
                    hx-vals='js:{
            "totalInventoryValue": document.getElementById("inventory-value").value,
            "oldInventoryValue": "@Model.Price"
        }'>
                <i class="bi bi-check-lg"></i>
                Save
            </button>

            <!-- Cancel -->
            <button type="button"
                    class="btn btn-outline-secondary"
                    title="Cancel editing"
                    hx-get="/Product/ReadRow/@Model.Id"
                    hx-target="closest tr"
                    hx-select="tr"
                    hx-swap="outerHTML swap:200ms">
                <i class="bi bi-x-lg"></i>
                Cancel
            </button>
        </div>
    </td>
</tr>